# Notes from Linux iptables Pocket Reference

- The Linux kernelâ€™s network packet processing subsystem is called Netfilter, and iptables is the command used to configure it. 
- iptables defines five "hook points" in the kernel's packet processing pathways. Built-in chains are attached to these hook points
- You can add a sequence of rules for each hook point
- Each rule represents an opportunity to affect or monitor packet flow

Hook | Allows you to process packets ..
--- | ---
FORWARD | ... that flow through a gateway computer, coming in one interface and going right back out another
INPUT | ... just before they are delivered to a local process
OUTPUT | ... just after they are generated by a local process
POSTROUTING | ... just before they leave a network interface
PREROUTING | ... just as they arrive from a network interface (after dropping any packets resulting from the interface being in promiscuous mode and after checksum validation)

Tables and chains are only partially correlated.
- *Chains* represent hook points in the packet flow
- *Tables* represent the types of processing that can occur

Table | Chains
--- | ---
nat | PREROUTING, POSTROUTING, OUTPUT
filter | FORWARD, INPUT, OUTPUT
mangle | PREROUTING, FORWARD, POSTROUTING, INPUT, OUTPUT

- The default table is the `filter` table; if you do not specify an explicit table in an iptables command, filter is assumed

**Commonly used flags**
```sh
-t # Table (filter, nat, or mangle)

-s # Source address range
-d # Desintation address range

-i # Input interface in (if in ends with +, any interface having a name that starts with in will match).
-o # Input interface out (if out ends with +, any interface having a name that starts with out will match).

-p # protocol name (i.e. tcp, udp, icmp)
--dport # Match when the TCP destination port number is equal to port

-m # Invoke extended match

-I # Inserts rule into chain
-A # Appends rule to chain
-D # Delete rule from chain
-R # Replaces the rule at position index of chain with the new rule. (chain index rule)

-P # Sets the default policy of the built-in chain to target. Applies to built-in chains and targets only.
-N # Creates a new user-defined chain.

--to-source # Change the source IP address field of the packet to the addresses given

-v # Verbose mode
-L # List the rules in a chain or all chains
-S # Print the rules in a chain or all chains
-c # Packet and byte counter
--line-numbers # When combined with the -L subcommand, displays numbers for the rules in each chain, so you can refer to the rules by index when inserting rules into (via -I) or deleting rules from (via -D) a chain.
```

**Reviewing rules**
```sh
# List chains and their rx/tx count
iptables -L -v

# List rules by chain
sudo iptables -S
```

## Resources
- Linux iptables Pocket Reference by Gregor N. Purdy Published by O'Reilly Media, Inc., 2004
